

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ROS Package bob_sd35 &mdash; Bob&#39;s Handbuch 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=0603aa02" />

  
    <link rel="shortcut icon" href="../../../_static/profile_image-300x300.png"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Bob's Handbuch
              <img src="../../../_static/bob_vv.gif" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bob-coquitts.html">ROS Package bob_coquitts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-flux2.html">ROS Package bob_flux2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-flux2k.html">ROS Package bob_flux2k</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-launch.html">ROS Package bob_launch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-llm.html">ROS Package bob_llm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-moondream.html">ROS Package bob_moondream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-moondream-msgs.html">ROS Package bob_moondream_msgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-msgs.html">ROS Package bob_msgs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-sd35.html">ROS Package bob_sd35</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-topic-tools.html">ROS Package bob_topic_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bob-vector-db.html">ROS Package bob_vector_db</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../voskros.html">ROS Package VoskRos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OTHER</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../vox.html">Package VOX Real-time Transcription</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Bob's Handbuch</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ROS Package bob_sd35</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/bob/src/bob_sd35/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ros-package-bob-sd35">
<h1>ROS Package <a class="reference external" href="https://github.com/bob-ros2/bob_sd35">bob_sd35</a><a class="headerlink" href="#ros-package-bob-sd35" title="Link to this heading"></a></h1>
<p>A ROS2 package for image generation using Stable Diffusion 3.5 Large.</p>
<p>This package provides two nodes:</p>
<ul class="simple">
<li><p><strong>itti</strong> - Image &amp; Text to Image generation (img2img)</p></li>
<li><p><strong>tti</strong> - Text to Image generation (text2img)</p></li>
</ul>
<p>Both nodes automatically download the SD3.5 model from HuggingFace on first run and support CPU offloading for systems with limited VRAM.</p>
<blockquote>
<div><p><strong>Note:</strong> The SD3.5 Large model is approximately <strong>67 GB</strong> in size. The initial download will take a significant amount of time depending on your internet connection.</p>
</div></blockquote>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading"></a></h2>
<section id="system-dependencies">
<h3>System Dependencies<a class="headerlink" href="#system-dependencies" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>ROS2 Humble</p></li>
<li><p>ros-humble-cv-bridge</p></li>
<li><p>ros-humble-image-transport</p></li>
</ul>
</section>
<section id="python-dependencies">
<h3>Python Dependencies<a class="headerlink" href="#python-dependencies" title="Link to this heading"></a></h3>
<p>Install via pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</section>
</section>
<section id="installation-and-building">
<h2>Installation and Building<a class="headerlink" href="#installation-and-building" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Note:</strong> It is recommended to use a Python virtual environment for installing the Python dependencies to avoid conflicts with system packages.</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clone the repository</span>
<span class="nb">cd</span><span class="w"> </span>~/ros2_ws/src
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/bob-ros2/bob_sd35.git

<span class="c1"># Install Python dependencies (preferably in a virtual environment)</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>bob_sd35/requirements.txt

<span class="c1"># Build the package</span>
<span class="nb">cd</span><span class="w"> </span>~/ros2_ws
colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>bob_sd35

<span class="c1"># Source the workspace</span>
<span class="nb">source</span><span class="w"> </span>install/setup.bash
</pre></div>
</div>
</section>
<section id="nodes">
<h2>Nodes<a class="headerlink" href="#nodes" title="Link to this heading"></a></h2>
<p>This package provides two nodes for different use cases:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Node</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">itti</span></code></p></td>
<td><p><strong>Image &amp; Text to Image</strong> - Transforms an input image based on a text prompt using img2img pipeline. Requires <code class="docutils literal notranslate"><span class="pre">input_image</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tti</span></code></p></td>
<td><p><strong>Text to Image</strong> - Generates images purely from text prompts using text2img pipeline. No input image required.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<section id="itti-node-image-to-image">
<h3>ITTI Node (Image-to-Image)<a class="headerlink" href="#itti-node-image-to-image" title="Link to this heading"></a></h3>
<p><strong>One-shot generation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>bob_sd35<span class="w"> </span>itti<span class="w"> </span>--ros-args<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>model_path:<span class="o">=</span>/path/to/models/stable-diffusion-3.5-large<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>input_prompt:<span class="o">=</span><span class="s2">&quot;a beautiful sunset&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>input_image:<span class="o">=</span>/path/to/input.jpg<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>output_image:<span class="o">=</span>auto<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>once:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p><strong>Continuous mode (topic-based):</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>bob_sd35<span class="w"> </span>itti<span class="w"> </span>--ros-args<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>model_path:<span class="o">=</span>/path/to/models/stable-diffusion-3.5-large<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>input_image:<span class="o">=</span>/path/to/default_input.jpg<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>output_image:<span class="o">=</span>auto
</pre></div>
</div>
<p>Then publish prompts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plain text prompt (uses input_image parameter)</span>
ros2<span class="w"> </span>topic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>--keep-alive<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>/input_prompt<span class="w"> </span>std_msgs/msg/String<span class="w"> </span><span class="s2">&quot;data: &#39;forest background&#39;&quot;</span>

<span class="c1"># JSON with image_url (ITTI only - overrides input_image parameter)</span>
ros2<span class="w"> </span>topic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>--keep-alive<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>/input_prompt<span class="w"> </span>std_msgs/msg/String<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;data: &#39;{\&quot;role\&quot;: \&quot;user\&quot;, \&quot;content\&quot;: \&quot;cosmic background\&quot;, \&quot;image_url\&quot;: \&quot;file:///path/to/image.jpg\&quot;}&#39;&quot;</span>
</pre></div>
</div>
</section>
<section id="tti-node-text-to-image">
<h3>TTI Node (Text-to-Image)<a class="headerlink" href="#tti-node-text-to-image" title="Link to this heading"></a></h3>
<p><strong>One-shot generation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>bob_sd35<span class="w"> </span>tti<span class="w"> </span>--ros-args<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>model_path:<span class="o">=</span>/path/to/models/stable-diffusion-3.5-large<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>input_prompt:<span class="o">=</span><span class="s2">&quot;a spacecraft in deep space&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>output_image:<span class="o">=</span>spacecraft.png<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>once:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p><strong>Continuous mode (topic-based):</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>bob_sd35<span class="w"> </span>tti<span class="w"> </span>--ros-args<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>model_path:<span class="o">=</span>/path/to/models/stable-diffusion-3.5-large<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span>output_image:<span class="o">=</span>auto
</pre></div>
</div>
<p>Then publish prompts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span>pub<span class="w"> </span>--once<span class="w"> </span>--keep-alive<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>/input_prompt<span class="w"> </span>std_msgs/msg/String<span class="w"> </span><span class="s2">&quot;data: &#39;a beautiful mountain landscape&#39;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="subscribed-topics">
<h2>Subscribed Topics<a class="headerlink" href="#subscribed-topics" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Topic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input_prompt</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">std_msgs/String</span></code></p></td>
<td><p>Text prompt to trigger image generation. For <strong>itti</strong>: accepts plain text or JSON with <code class="docutils literal notranslate"><span class="pre">role</span></code>, <code class="docutils literal notranslate"><span class="pre">content</span></code>, and <code class="docutils literal notranslate"><span class="pre">image_url</span></code> keys. For <strong>tti</strong>: plain text only.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="published-topics">
<h2>Published Topics<a class="headerlink" href="#published-topics" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Topic</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">generated_image</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sensor_msgs/Image</span></code></p></td>
<td><p>Generated image published when subscribers are connected.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="ros-parameters">
<h2>ROS Parameters<a class="headerlink" href="#ros-parameters" title="Link to this heading"></a></h2>
<p>Both nodes share most parameters. Parameters marked with <strong>(itti only)</strong> are only available in the <code class="docutils literal notranslate"><span class="pre">itti</span></code> node.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">model_repo</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">stabilityai/stable-diffusion-3.5-large</span></code></p></td>
<td><p>HuggingFace model repository ID.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">model_path</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">./models/stable-diffusion-3.5-large</span></code></p></td>
<td><p>Path to the local model directory.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input_prompt</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>Initial prompt for generation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">input_image</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p><strong>(itti only)</strong> Initial input image path.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">output_image</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">output.png</span></code></p></td>
<td><p>Output image path. If ending with <code class="docutils literal notranslate"><span class="pre">auto</span></code>, generates unique filenames.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">strength</span></code></p></td>
<td><p>double</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0.6</span></code></p></td>
<td><p><strong>(itti only)</strong> Denoising strength (0.0-1.0). Low=keep original, high=more change.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">guidance_scale</span></code></p></td>
<td><p>double</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">4.5</span></code></p></td>
<td><p>Classifier-free guidance scale.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">negative_prompt</span></code></p></td>
<td><p>string</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code></p></td>
<td><p>Negative prompt to exclude unwanted elements from generation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">num_inference_steps</span></code></p></td>
<td><p>int</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">40</span></code></p></td>
<td><p>Number of inference steps.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">once</span></code></p></td>
<td><p>bool</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
<td><p>If true, shuts down after first generation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cpu_offload</span></code></p></td>
<td><p>bool</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
<td><p>Enable model CPU offload to save VRAM.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">keep_model_loaded</span></code></p></td>
<td><p>bool</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
<td><p>Keep model loaded between generations. Set to true to save loading time.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">keep_alive</span></code></p></td>
<td><p>double</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1.0</span></code></p></td>
<td><p>Seconds to wait before shutdown when <code class="docutils literal notranslate"><span class="pre">once</span></code> is true, allowing consumers to receive messages.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">seed</span></code></p></td>
<td><p>int</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-1</span></code></p></td>
<td><p>Random seed for reproducibility. Use -1 for random seed each generation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">image_counter_start</span></code></p></td>
<td><p>int</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Starting value for auto image numbering.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h2>
<p>All parameters can also be set via environment variables with prefix <code class="docutils literal notranslate"><span class="pre">ITTI_</span></code> for the itti node and <code class="docutils literal notranslate"><span class="pre">TTI_</span></code> for the tti node (e.g., <code class="docutils literal notranslate"><span class="pre">ITTI_MODEL_PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">TTI_GUIDANCE_SCALE</span></code>).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright BobRos.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>